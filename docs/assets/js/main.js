"use strict";const inputValue=document.querySelector(".value"),searchButton=document.querySelector(".search-button"),inputGenre=document.querySelector(".genre"),searchButton2=document.querySelector(".search-button2"),series=document.querySelector(".space-series"),favouriteSpace=document.querySelector(".favourite-Space"),reset=document.querySelector(".remove"),collapsable=document.querySelector(".favourite-Space-title"),favouritesSaved=document.querySelector(".my-favs"),url="http://api.tvmaze.com/search/shows?q=";function serching(){fetch(url+(inputValue.value||inputGenre.value)).then(handleErrors).then(e=>e.json()).then(e=>{series.innerHTML="";for(let t=0;t<e.length;t++){let i={id:e[t].show.id,name:e[t].show.name};null===e[t].show.image?i.imageMedium="https://via.placeholder.com/210x295/ffffff/666666/?text=TV":i.imageMedium=e[t].show.image.medium,series.innerHTML+=generateSerieContent(i)}updateFavoriteClickEvent()}).catch(function(e){console.log(e),series.innerHTML="Vuelve a intentarlo mÃ¡s tarde, se ha producido un error"})}function favSav(e){let t=JSON.parse(localStorage.getItem("favouriteSerieListStored")),i=!1;if(null!=t&&(i=t.includes(e.target.id)),i){const i=document.querySelectorAll("[id='"+e.target.id+"']");for(let e of i)e.classList.add("noLike"),e.classList.remove("like");null===t&&void 0===t||(t=t.filter(function(t,i,r){return t!==e.target.id}))}else e.target.classList.add("like"),e.target.classList.remove("noLike"),null==t?t=[e.target.id]:t.push(e.target.id);localStorage.setItem("favouriteSerieListStored",JSON.stringify(t)),showFavourites()}function isFavouriteSerie(e){let t=localStorage.getItem("favouriteSerieListStored");return null==t?"noLike":(t=JSON.parse(t)).includes(e)?"like":"noLike"}function handleErrors(e){if(!e.ok)throw Error(e.statusText);return e}function showFavourites(){favouriteSpace.innerHTML="";const e=JSON.parse(localStorage.getItem("favouriteSerieListStored"));if(null!=e&&null!=e)for(let t of e){const e=JSON.parse(decodeURIComponent(t));favouriteSpace.innerHTML+=generateSerieContent(e)}updateFavoriteClickEvent()}function generateSerieContent(e){const t=encodeURIComponent(JSON.stringify(e));let i='<div class="serie-space">';return i+='<ul class="serie" >',i+='<li class="space-title '+isFavouriteSerie(t)+'" id="'+t+'">'+e.name+"</li>",i+='<li class="space-image"><img src="'+e.imageMedium+'"/></li>',i+='<li class="reference">'+e.id+"</li>",i+='<li class="info"> <a class="link" href= "info.html?id='+e.id+'"></a></li>',i+="</ul>",i+="</div>",console.log(e.id),console.log("El id de la serie es "+e.id+" y lo voy a usar"),i}function removing(){localStorage.clear(),showFavourites()}function updateFavoriteClickEvent(){for(let e of document.querySelectorAll(".noLike"))e.addEventListener("click",favSav);for(let e of document.querySelectorAll(".like"))e.addEventListener("click",favSav)}function openFavourites(){favouritesSaved.classList.contains("hidden")?favouritesSaved.classList.remove("hidden"):favouritesSaved.classList.add("hidden")}searchButton.addEventListener("click",serching),searchButton2.addEventListener("click",serching),inputValue.addEventListener("keyup",e=>{13===e.keyCode&&serching()}),showFavourites(),reset.addEventListener("click",removing),collapsable.addEventListener("click",openFavourites);